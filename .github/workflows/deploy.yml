name: üöÄ Auto-Deploy to Vercel

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '.gitignore'
      - '.prettierignore'
      - 'docs/**'

jobs:
  deploy:
    name: D√©ployer sur Vercel
    runs-on: ubuntu-latest
    
    steps:
      - name: D√©clencher le d√©ploiement Vercel
        run: |
          echo "üöÄ D√©clenchement du d√©ploiement Vercel..."
          echo "üìã Commit: ${{ github.sha }}"
          echo "üìã Branch: ${{ github.ref }}"
          
          if [ -z "${{ secrets.VERCEL_DEPLOY_HOOK }}" ]; then
            echo "‚ùå ERREUR: Le secret VERCEL_DEPLOY_HOOK n'est pas d√©fini !"
            exit 1
          fi
          
          echo "üì° Appel du Deploy Hook Vercel..."
          RESPONSE=$(curl -s -w "\nHTTP_STATUS:%{http_code}" -X POST "${{ secrets.VERCEL_DEPLOY_HOOK }}")
          
          HTTP_STATUS=$(echo "$RESPONSE" | grep "HTTP_STATUS" | cut -d: -f2)
          BODY=$(echo "$RESPONSE" | sed '/HTTP_STATUS/d')
          
          echo "üìä R√©ponse HTTP: $HTTP_STATUS"
          echo "üìÑ Body: $BODY"
          
          if [ "$HTTP_STATUS" -ge 200 ] && [ "$HTTP_STATUS" -lt 300 ]; then
            echo "‚úÖ D√©ploiement d√©clench√© avec succ√®s !"
            echo "‚úÖ Status: $HTTP_STATUS"
          else
            echo "‚ùå Erreur lors du d√©clenchement du d√©ploiement"
            echo "‚ùå Status HTTP: $HTTP_STATUS"
            echo "‚ùå R√©ponse: $BODY"
            exit 1
          fi
